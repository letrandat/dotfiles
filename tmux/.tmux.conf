# ============================================================================
# Prefix Configuration
# ============================================================================
# Alternative prefix: Ctrl+Space (triggered by Opt+Space via Ghostty)
set -g prefix2 C-Space
bind C-Space send-prefix -2

# ============================================================================
# General Settings
# ============================================================================
# Start windows and panes from 1 instead of 0
set -g base-index 1
setw -g pane-base-index 1

# Status bar configuration
set -g status-left ""
# Display "1(cli)" for pane 1 and "2(llm)" for pane 2 in the status bar
set -g status-right "#{?#{==:#{pane_index},1},1(cli),#{?#{==:#{pane_index},2},2(llm),#{pane_index}}} | #S"
set -g status-right-length 100
# Display the pane index in brackets [N] when the window is zoomed
set -g window-status-format " #I:#W#{?window_zoomed_flag,[#{pane_index}],}#F "
set -g window-status-current-format " #I:#W#{?window_zoomed_flag,[#{pane_index}],}#F "

# Copy mode with vi bindings
setw -g mode-keys vi

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Enable mouse support for scrolling and pane management
set -g mouse on
bind -n MouseDown1Status select-window -t=
# Double-click on the window name in the status bar to rename it
bind -n DoubleClick1Status command-prompt -I "#W" "rename-window '%%'"

# ============================================================================
# Copy Mode Configuration
# ============================================================================
# Enter copy mode with 'prefix v'
bind-key v copy-mode

# Copy mode vi bindings
bind-key -T copy-mode-vi v send -X begin-selection
# Remap Y to copy to end of line to clipboard
bind-key -T copy-mode-vi Y send-keys -X begin-selection \; send-keys -X end-of-line \; send-keys -X copy-pipe-and-cancel "pbcopy"
# Copy to clipboard
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Smart PageUp: Enter copy-mode-vi if not in an alternate screen app (like Vim)
bind-key -n PageUp if-shell -F "#{alternate_on}" "send-keys PageUp" "copy-mode -u"

# ============================================================================
# Pane Management ("Buffer" metaphor)
# ============================================================================
# Close pane: prefix b d
bind b switch-client -T buffer-menu
bind -T buffer-menu d kill-pane

# Split panes: prefix w v (vertical), prefix w s (horizontal)
bind w switch-client -T window-menu
bind -T window-menu v split-window -h -c "#{pane_current_path}"
bind -T window-menu s split-window -v -c "#{pane_current_path}"

# Focus specific panes with zoom
bind -T window-menu m select-pane -t :.1 \; resize-pane -Z

# Arrow key pane navigation
bind Left select-pane -L
bind Down select-pane -D
bind Up select-pane -U
bind Right select-pane -R

# Pick panes/buffers: prefix ,
bind , choose-tree -Z

# ============================================================================
# Window Management (Browser style)
# ============================================================================
# New window: prefix t
bind t new-window -c "#{pane_current_path}"

# Close window: prefix w d
bind -T window-menu d kill-window

# Search/switch windows in current session: prefix a
bind a choose-window

# Rename window: prefix R
bind R command-prompt -I "#W" "rename-window '%%'"

# Reload configuration: prefix l
bind l source-file ~/.tmux.conf \; display-message "Tmux config loaded!"

# ============================================================================
# Special Shortcuts (Ghostty integration)
# ============================================================================
# Focus AI/Aux pane (index 1) and zoom
# Toggle between panes with zoom (Cmd+L via Ghostty): if on pane 2, go to last-pane; otherwise go to pane 2
bind . if-shell '[ "#{pane_index}" = "2" ]' 'last-pane; resize-pane -Z' 'select-pane -t :.2; resize-pane -Z'
# Window Navigation
bind H previous-window
bind L next-window
